---
title: "Butterflies and Macro-Moths in Great Britain and Ireland (2022)"
output: html_document
date: "April 22, 2025"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, out.width="60%", echo=FALSE, fig.align = "center"}
knitr::include_graphics("./image/purple_emperor.jpeg")
```
<body style="background-color: lightgrey;">

### Introduction

Butterflies and moths are a very important part of the ecosystem. They are natural pollinators, important food sources for various animals, and they can indicate ecological changes to the environment. 

In 2022, the UK has seen decreases in its butterfly population since the 1970's [1]. A staggering 80% of the entire butterfly population across Wales, Northern Ireland, Scotland, and England have been observed. This shows that butterfly diversity is decreasing. 

For moths, light pollution was a significant factor that seemed to be aiding in the decrease of moth populations. "Eco-friendly" LED lights replaced many of the typical sodium light bulbs in England [2]. This led to moths hovering around lights, being eaten by predators, and laying less eggs. Thankfully, LED lights are dimable, allowing for a quick fix that would be able to help the struggling moth population.

### Backround: So, why butterflies and moths?

Ever since I was a young girl, I had been interested in insects. I used to collect them in jars, give them a little dirt, a couple of leaves, screw the lid on, and then lose the jar. Much to the chagrin of my little, innocent mind, I'd end up finding the jars... with just little stick legs remaining. In my garden, there were many, many caterpillars. They used to eat my father's petunias, one of his favorite flowers. So, because I loved caterpillars and wanted them out of the garden, I did what I knew best and created a caterpillar jar. 

This caterpillar jar had about a dozen caterpillars that I thought were going to turn into butterflies. Once I had lost and then reclaimed my jar, I found silken webs around the inside of the jar. Once I did some research, it turned out that the insects were caterpillar moths. So cool!

So, now there is some background to why I think that they are interesting, lets get into some research! I found some interesting data for butterflies and moths that currently reside (or did) in both Ireland and Great Britain in 2022 [3]. This data set includes ecological traits, excluded species, excluded host subspecies, and host plants. I am using the ecological traits data set. I am exploring if there are specific traits between species provided in this dataset that ultimately determine the species and their decline in population.

## Data

Libraries used:
```{r libraries, message=FALSE, warning=FALSE, results ='hide'}
library(tidyverse)
library(janitor)
library(ggplot2)
library(easystats)
library(MASS)
library(caret)
```

```{r removingupperstuffongraph, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}

data = read.csv("./Butterfly+moths_folder/33a66d6a-dd9b-4a19-9026-cf1ffb969cdb/data/ecological_traits_2022.csv")
colnames(data) = as.character(data[1, ])

data = data[-1, ]

rownames(data) = NULL

colnames(data)[duplicated(colnames(data))]
colnames(data) = make.names(colnames(data), unique = TRUE) 

data$rarirty_gb = as.character(data$rarirty_gb)

data = data %>% 
  mutate(rarirty_gb = ifelse(rarirty_gb == "", "Not Assessed", rarirty_gb)) %>%
  mutate(rarirty_gb = case_when(
    rarirty_gb == "recent (year 2000 onwards) colonist not assessed" ~ "Too Recent to Assess",
    TRUE ~ rarirty_gb
  ))

newggplot = data %>% 
  ggplot(aes(x = rarirty_gb)) +
  geom_bar() +
  labs(title = "Number of Species vs. Rarity",
    x = "Rarity",
    y = "Number of Species") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

This data shows the number of species and their rarities:

```{r, ggplot1, echo=FALSE}
plot(newggplot)
```

From this plot, it is apparent that the majority of butterfly and moth species are uncounted for. Other than that large category, the next largest category that butterflies and moths fall in are "Nationally Scarce." 

```{r egg_data, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}

egg_data = data %>%
  pivot_longer(cols = starts_with("egg_"),
               names_to = "month",
               values_to = "egg_present") %>%
  mutate(month = str_replace(month, "egg_", "")) %>%
  mutate(month = str_to_title(month)) %>%
  mutate(month = factor(month, levels = month.abb))  

unique(egg_data$egg_value)

egg_counts_clean = egg_data %>%
  filter(egg_present %in% c("1", "1`")) %>%
  group_by(month) %>%
  summarise(species_with_eggs = n())
```

```{r ggplot2, echo=FALSE}
egg_counts_clean %>% 
  ggplot(aes(x = month, y = species_with_eggs)) +
  geom_col(fill = "mediumvioletred") +
  labs(title = "Species in Egg Stage by Month",
    x = "Month",
    y = "Number of Species") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

From this data, it is apparent that most species are in their egg stage by June, July, and August. Using the first graph and combining it with this one, the correlation between the month of the egg stage and rarity can be assessed. 



```{r ggplot3, echo=FALSE, message=FALSE, warning=FALSE}

egg_rarity_counts = egg_data %>%
  filter(egg_present %in% c("1", "1`")) %>%
  group_by(rarirty_gb, month) %>%
  summarise(species_with_eggs = n()) %>%
  ungroup()

egg_rarity_counts %>%
  filter(rarirty_gb != "Not Assessed") %>%
  ggplot(aes(x = month, y = species_with_eggs, fill = rarirty_gb)) +
  geom_col(position = "dodge") +
  labs(title = "Egg Stage by Month and Species Rarity",
       x = "Month",
       y = "Number of Species",
       fill = "Rarity") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

There may be a correlation between the month that these species were in their egg stage and how scarce they are. However, there are many other factors to assess, such as if their nocturnal or diurnal nature have a profound effect on their natural abundance. 

```{r linearmod1, echo=FALSE, message=FALSE, warning=FALSE}
egg_logit_data = egg_data %>%
  filter(egg_present %in% c("1", "1`")) %>%
  mutate(month_num = as.numeric(month)) %>%
  mutate(is_scarce = ifelse(rarirty_gb == "Nationally Scarce", 1, 0))

# Fit a logistic regression model
logit_model = glm(data = egg_logit_data,
                   formula = is_scarce ~ month_num,
                   family = "binomial")
```

However, looking at species that are nationally scarce and the month of their egg stage, the Tjur R2 value is extremely low. This means that there is no correlation between the two variables:

```{r perform1, echo=FALSE}
performance(logit_model)
```

```{r perform2}
logit_model2 = glm(data = egg_logit_data,
                   formula = is_scarce ~ month_num + nocturnal. + forewing_maximum,
                     family = "binomial")


logit_model3 = glm(data = egg_logit_data,
                   formula = is_scarce ~ month_num + diurnal. + reintroduced + immigrant.,
                     family = "binomial")


logit_model4 = glm(data = egg_logit_data,
                   formula = is_scarce ~ month_num + diurnal. + reintroduced + immigrant.,
                     family = "binomial")

logit_model4 = glm(data = egg_logit_data,
                   formula = is_scarce ~ month_num + diurnal. + reintroduced + immigrant.,
                     family = "binomial")



# 1. Exclude columns 1:22
potential_predictors <- egg_logit_data[, -c(1:22)]

# 2. Keep only columns with more than 1 unique value
valid_cols <- potential_predictors[, sapply(potential_predictors, function(x) length(unique(x)) > 1)]

# 3. Create formula dynamically
formula <- as.formula(paste("is_scarce ~", paste(colnames(valid_cols), collapse = " + ")))

# 4. Fit logistic regression model
full_model <- glm(formula, data = egg_logit_data, family = "binomial")
```